name: CI

on: [push]

defaults:
  run:
    shell: bash

jobs:
  build-linux:
    runs-on: ubuntu-latest
    env:
      DYNAWO_BUILD_TYPE: Debug
      DYNAWO_RESULTS_SHOW: "false"
      DYNAWO_INSTALL_OPENMODELICA: ${{ github.workspace }}/OpenModelica/Install
      DYNAWO_SRC_OPENMODELICA: ${{ github.workspace }}/OpenModelica/Source
      DYNAWO_CMAKE_GENERATOR: Ninja
      DYNAWO_NB_PROCESSORS_USED: 2
    steps:
      - name: Checkout sources
        uses: actions/checkout@v1

      - name: Build omc
        run: |
          dnf install -y ninja-build
          export DYNAWO_HOME=$(pwd)
          util/envDynawo.sh build-omcDynawo

      - name: Build 3rd party
        run: |
          export DYNAWO_HOME=$(pwd)
          util/envDynawo.sh build-3rd-party

      - name: Build core
        run: |
          export DYNAWO_HOME=$(pwd)
          util/envDynawo.sh config-dynawo
          util/envDynawo.sh build-dynawo-core

      - name: Build models cpp
        run: |
          export DYNAWO_HOME=$(pwd)
          util/envDynawo.sh build-dynawo-models-cpp

      - name: Build models
        run: |
          export DYNAWO_HOME=$(pwd)
          util/envDynawo.sh build-dynawo-models

      - name: Build solvers
        run: |
          export DYNAWO_HOME=$(pwd)
          util/envDynawo.sh build-dynawo-solvers
